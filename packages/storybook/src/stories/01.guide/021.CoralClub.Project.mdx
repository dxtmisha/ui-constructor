import { Meta, Subtitle } from '@storybook/blocks'

<Meta title="Руководство/Развернут проект на сайте"/>

# Развернут проект на сайте
<Subtitle>
  Рекомендуется, если нужно разрабатывать полноценную страницу или компонент.
</Subtitle>

## Обзор
Можно развернуть полноценный проект Vite + Vue3 для разработки как простого компонента, так и полноценной страницы.
Такие проекты собираются без модулей Vue и UI, и подключаются к глобальным модулям.
Это удобно в том, что при обновлении UI не надо будет пересобирать все проекты.
В таких проектах можно подключать любые пакеты, плагины.

<b>Если подключить проект как компонент</b>, есть ограничения в том, что нельзя использовать дополнительные
плагины, как vue-router, vuex или любые другие пакеты, где нужен доступ к app.

## Руководство
По умолчанию скрипты UI не будут подключаться. Для подключения надо вызвать класс в PHP <code>Ui::active()</code>.

```php
// *.php
use CCI\Ui\Ui;
Ui::active();
```

Скрипты также можно включить в <b>тестовый режим</b>. Для этого надо добавить в URL GET-параметр <code>UI_ACTIVE=active</code>.

```
https://ru.coral.club/?UI_ACTIVE=active
```

В тестовом режиме можно открыть Инспектор и редактировать HTML-код, добавляя код подключения компонентов.
Это также нужно для проверки, не слетел ли сайт после подключения UI.

### Добавление компонента на сайт
Добавление компонента можно в любом месте через атрибут <code>data-ui</code> у любого элемента.
После этого внутри элемента создается новый элемент компонента.
Любое содержимое внутри элемента изначально будет считаться как слот по умолчанию.
Все свойства передаются как data-атрибуты. Сделано через data-атрибуты, чтобы редактор не ругался на неизвестные атрибуты.
Доступ к атрибутам <code>class</code> и <code>style</code> элемента можно получить через <code>data-class</code> и <code>data-style</code>.

#### Пример:

```html
<div
  data-ui="c2-button"
  data-icon="bank"
  data-label="Label"
  data-class="c2-palette--carmine"
  data-style="height: 52px"
></div>
```

Компоненты можно добавлять в DOM или удалять в любое время.
Для удаления надо просто убрать элемент с атрибутом <code>data-ui</code> из DOM.

#### Пример:

```html
<div
  id="ui-test-1"
  data-ui="c2-button"
  data-label="Label"
></div>
<script>
  window.addEventListener('DOMContentLoaded', () => {
    document.querySelector('#ui-test-1').remove()
  })
</script>
```

Для взаимодействия с компонентом используем глобальную переменную JS <code>UI.comp</code>.

### Изменение данных
Изменить данные можно через глобальную функцию <code>UI.comp</code>.
Вызывать можно только после полной загрузки документа, используя событие <code>DOMContentLoaded</code>.

```
UI.comp(id: string, props: Record<string, any>)
```

<code>UI.comp</code> принимает 2 параметра, первый - это id элемента, второй - объект со списком props, который надо изменить.

#### Пример:

```html
<div
  id="ui-test-2"
  data-ui="c2-button"
  data-label="Счетчик: 1"
></div>
<script>
  window.addEventListener('DOMContentLoaded', () => {
    let number = 1

    setInterval(() => {
      // Используем UI.comp для изменения данных
      UI.comp(
        'ui-test-2',
        { label: `Счетчик: ${++number}` }
      )
    }, 1000)
  })
</script>
```

### Работа с событиями
Если второй параметр метода <code>UI.comp</code> передать значения с ключами,
начинающимися с <code>on</code>, он будет регистрироваться как события или emit.
Также можно удалить события, передав значение равное <code>undefined</code>.

```
<script>
  UI.comp(
    id: string,
    props: {
      onEventName1: (event: Event) => void,
      onEventName2: (event: Event) => void
    }
  )
</script>
```

#### Пример:

```html
<div
  id="ui-test-3"
  data-ui="c2-button"
  data-label="Нажми"
></div>
<script>
  window.addEventListener('DOMContentLoaded', () => {
    UI.comp(
      'ui-test-3',
      // Регистрирует событие click на элемент
      { onClick: () => alert('click') }
    )
  })
</script>
```

### Работа со слотами
Для работы со слотами есть 2 способа.
Через под-элемент и атрибут <code>data-slot</code> или функцию <code>UI.comp</code>, через свойство <code>slots</code>.
Предпочтительнее через атрибут <code>data-slot</code>. Это делает код более читабельным. А для редактирования слота через <code>UI.comp</code>.

Если у под-элемента не будет атрибута <code>data-slot</code>, то эти элементы будут приниматься как элементы слота с названием <code>default</code>.

#### Пример:

```html
<!-- Под элемент без data-slot будет считаться как элемент слота default -->
<div data-ui="c2-button">Label</div>

<div data-ui="m3-window">
  <!-- Тут создаем элемент для слота control -->
  <div data-slot="control" style="display: none">
    <div
      data-ui="c2-button"
      data-label="Открыть меню"
    ></div>
  </div>
  <!-- Тут создаем элемент для слота default -->
  <div data-slot="default" style="display: none">
    <div class="px-4 py-6">
      Мы помогаем людям сделать разумный выбор в пользу заботы о здоровье,
      предлагая комплексные решения, основанные на передовых технологиях
      и многолетнем опыте нутрициологов со всего мира.
    </div>
  </div>
</div>

<div
  id="ui-test-6"
  data-ui="c2-button"
></div>
<script>
  window.addEventListener('DOMContentLoaded', () => {
    // Добавление слота default через метод UI.comp
    UI.comp('ui-test-6', { slots: { default: 'Label' } })
  })
</script>
```

