import{r,o as v}from"./getElement-uQ-JTFk--VVvc7s1q.js";import{n as p}from"./isNull-CjWwlQS3-GxMmF9sj.js";import{c as m,s as y}from"./DesignConstructorAbstract-pm1V7i1G-DKYGky5W.js";var d=Object.defineProperty,E=(s,t,e)=>t in s?d(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,n=(s,t,e)=>(E(s,typeof t!="symbol"?t+"":t,e),e);function c(s){return v(s)?s:r(s)}function f(s){var t;return!!((t=r(s))!=null&&t.closest("html"))}class z{constructor(t,e=["click"],i,l,a){n(this,"element"),n(this,"elementControl"),n(this,"elementControlEdit"),n(this,"type"),n(this,"listenerRecent",u=>{var h,o;f(this.elementControl)?((h=this.listener)==null||h.call(this.element,u,this.detail),y(this.options)&&(o=this.options)!=null&&o.once&&this.stop()):this.stop()}),n(this,"activity",!1),n(this,"activityItems",[]),this.listener=i,this.options=l,this.detail=a,this.element=c(t),this.elementControl=r(t),this.type=m(e)}isActive(){return this.activity}setElement(t){const e=c(t);return this.elementControlEdit||(this.elementControl=r(t)),this.element=e,this.reset(),this}setElementControl(t){return this.elementControl=r(t),this.elementControlEdit=!p(this.elementControl),this.elementControlEdit||(this.elementControl=r(this.element)),this}setType(t){return this.type=m(t),this.reset(),this}setListener(t){return this.listener=t,this}setOptions(t){return this.options=t,this.reset(),this}setDetail(t){return this.detail=t,this}dispatch(t=this.detail){return this.type.forEach(e=>{var i;return(i=this.element)==null?void 0:i.dispatchEvent(new CustomEvent(e,{detail:t}))}),this}start(){return this.activity||(this.activity=!0,this.activityItems=[],this.type.forEach(t=>{this.element&&!(t==="resize"&&this.makeResize())&&!(t==="scroll-sync"&&this.makeScroll())&&(this.element.addEventListener(t,this.listenerRecent,this.options),this.activityItems.push({element:this.element,type:t}))})),this}stop(){return this.activity&&(this.activity=!1,this.activityItems.forEach(({element:t,type:e,listener:i,observer:l})=>{l?l.disconnect():i?t==null||t.removeEventListener(e,i):t==null||t.removeEventListener(e,this.listenerRecent)})),this}toggle(t){return t?this.start():this.stop()}reset(){return this.activity&&(this.stop(),this.start()),this}isObserver(){return"ResizeObserver"in window}makeResize(){if(this.element&&this.element instanceof HTMLElement&&this.element!==document.body&&this.isObserver()){const t=new ResizeObserver(e=>this.listenerRecent(e==null?void 0:e[0]));return t.observe(this.element),this.activityItems.push({element:this.element,type:"resize",observer:t}),!0}return!1}makeScroll(){if(this.element){let t=!1;const e=i=>{t||(t=!0,requestAnimationFrame(()=>{this.listenerRecent(i),t=!1}))};return this.element.addEventListener("scroll",e,this.options),this.element.addEventListener("resize",e,this.options),this.activityItems.push({element:this.element,type:"scroll",listener:e},{element:this.element,type:"resize",listener:e}),!0}return!1}}export{z as R};
