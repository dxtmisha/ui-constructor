import{x,w as $,h as g,c as m,s as d,a as p}from"./vue.esm-bundler-C0PuLcVh.js";import{Z as j}from"./DesignConstructorAbstract-pm1V7i1G-AwalHq2u.js";import{z as u,x as H}from"./GeoIntl-DH3GBVnO-Ba8p-fOD.js";import{o as w}from"./DesignAsyncAbstract-Bi5cMulT-_fSgJIaJ.js";import{$ as W,g as k}from"./GeoFlag-DfvLx1lW-BCKykf8X.js";import{a as C}from"./isArray-QlWcxgml-TsNjkBGN.js";import{r as F}from"./getElement-uQ-JTFk--VVvc7s1q.js";import{t as I}from"./isFilled-ClO-1E4U-BUdjZhTW.js";import{i as f}from"./toNumber-eA5ODeva-B35HWKKW.js";import{R as A}from"./EventItem-CNRiCeQO-Z63F0Mu0.js";function B(i,t){return Math.floor(Math.random()*(t-i+1)+i)}let v=B(1e5,9e5);function R(i,t){const e=F(i);return e?(I(e.id)||e.setAttribute("id",`id-${v++}`),t?`#${e.id}${t}`.trim():e.id):`id-${v++}`}var E=Object.defineProperty,M=(i,t,e)=>t in i?E(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,a=(i,t,e)=>(M(i,typeof t!="symbol"?t+"":t,e),e);const P=1280;class S{static isImage(t){return!!t.type.match(/^image\//)}static createImage(t){return new Promise(e=>{if(t){const s=new Image;s.onerror=()=>e(void 0),s.onload=()=>{e({image:s,src:this.getSRC(s,t),width:s.naturalWidth,height:s.naturalHeight})},(async()=>s.src=t instanceof File?await this.getFileResult(t):t)()}else e(void 0)})}static getPath(t){return this.createImage(t).then(e=>(e==null?void 0:e.src)??"")}static getFileResult(t){return new Promise(e=>{this.isImage(t)?this.getFileReader(t).then(s=>e(s)):e("")})}static getFileReader(t){return new Promise(e=>{const s=new FileReader;s.onload=()=>e(typeof s.result=="string"?s.result:""),s.readAsDataURL(t)})}static getSRC(t,e,s=P){var h;if((e instanceof File||e===void 0)&&(t.naturalHeight>s||t.naturalWidth>s)){const o=t.naturalWidth>=t.naturalHeight,l=(h=document.createElement("canvas"))==null?void 0:h.getContext("2d");return l?(l.canvas.width=o?s:t.naturalWidth/t.naturalHeight*s,l.canvas.height=o?t.naturalHeight/t.naturalWidth*s:s,l.drawImage(t,0,0,l.canvas.width,l.canvas.height),l.canvas.toDataURL()):""}else return t.src}}const b="#toolbar=0&scrollbar=1";class z{static isPdf(t){return u(t)?!!t.match(/\.pdf$/i):!!t.type.match(/\/pdf$/i)}static async get(t){return u(t)?`${t}${b}`:this.isPdf(t)?`${await S.getFileReader(t)}${b}`:""}}var r=(i=>(i.pdf="pdf",i.file="file",i.image="image",i.flag="flag",i.color="color",i.public="public",i.filled="filled",i.outlined="outlined",i.round="round",i.sharp="sharp",i.twoTone="two-tone",i.material="material",i.icon="icon",i))(r||{});class G extends H{constructor(t){super(()=>this.update()),this.props=t}get(){var t;return this.getCache([(t=this.props)==null?void 0:t.value])}update(){var t;const e=(t=this.props)==null?void 0:t.value;if(e){if(z.isPdf(e))return r.pdf;if(e instanceof File)return r.file;if(e.match(/\//))return r.image;if(e.match(W))return r.icon;if(e.match(/^#/))return r.color;if(e.match(/^@/))return r.public;if(e.match(/^\$/))return r.material;if(e.match(/^flag-[a-z]{2}$/))return r.flag;const s=e.match(/^(filled|outlined|round|sharp|two-tone)-/);return s?s[1]:k.is(e)?r.public:r.material}}}class O extends w{constructor(t,e,s){var h;super(t,s,["value","url"]),a(this,"item"),this.type=e,(h=this.props)!=null&&h.value&&this.make()}is(){return this.getImage()!==void 0}isLink(){return this.is()&&typeof this.getImage()=="string"}isImage(){return this.is()&&typeof this.getImage()!="string"}getImage(){var t;return(t=this.event)==null?void 0:t.image}async initEvent(){this.isChanged("image",["value","url"])&&(this.event.image=await this.initImage())}async initImage(){var t,e;const s=(t=this.props)==null?void 0:t.value;if(s)switch(this.type.get()){case r.pdf:return await z.get(s);case r.image:case r.file:try{return await S.createImage(s)}catch{console.error(Image,s)}break;case r.public:case r.icon:case r.flag:if(u(s))return await k.get(s,(e=this.props)==null?void 0:e.url);break}}}class V{constructor(t){this.props=t}is(){var t;const e=(t=this.props)==null?void 0:t.coordinator;return C(e)&&e.length>0&&e.length<5}get(){const t=this.getCoordinator();return{width:100-t[1]-t[3],height:100-t[2]-t[0]}}getCoordinator(){var t;if(this.is()){const e=(t=this.props)==null?void 0:t.coordinator;switch(e.length){case 1:return[e[0],e[0],e[0],e[0]];case 2:return[e[0],e[1],e[0],e[1]];case 3:return[e[0],e[1],e[2],e[1]];case 4:return e}}return[0,0,0,0]}getSize(){const t=this.get();return{width:`${100/t.width*100}%`,height:`${100/t.height*100}%`}}}class T{constructor(t,e){this.props=t,this.coordinator=e}getX(){var t,e;return this.coordinator.is()?`${this.coordinator.getCoordinator()[3]+this.coordinator.get().width/2}%`:((e=(t=this.props)==null?void 0:t.x)==null?void 0:e.toString())||"center"}getY(){var t,e;return this.coordinator.is()?`${this.coordinator.getCoordinator()[0]+this.coordinator.get().height/2}%`:((e=(t=this.props)==null?void 0:t.y)==null?void 0:e.toString())||"center"}}class N{constructor(t){a(this,"factorMax",1),a(this,"size",{width:0,height:0}),a(this,"offset",{width:7680,height:7680}),this.name=t}is(t){return this.name===t}isSize(){return!!(this.size.width||this.size.width)}getWidth(){return this.size.width}getHeight(){return this.size.height}getOffsetWidth(){return this.offset.width}getOffsetHeight(){return this.offset.height}getFactorMax(){return this.factorMax}makeWidth(t){return t>this.size.width&&(this.size.width=t),this}makeHeight(t){return t>this.size.height&&(this.size.height=t),this}makeOffsetWidth(t){return t<this.offset.width&&(this.offset.width=t),this}makeOffsetHeight(t){return t<this.offset.height&&(this.offset.height=t),this}makeFactorMax(t){return t<this.factorMax&&(this.factorMax=t),this}reset(){return this.factorMax=1,this.size={width:0,height:0},this.offset={width:7680,height:7680},this}}class c{static isSize(){return this.items.find(t=>t.isSize())!==void 0}static get(t){return this.find(t)||this.init(t)}static reset(){this.items.forEach(t=>t.reset())}static find(t){return this.items.find(e=>e.is(t))}static init(t){const e=new N(t);return this.items.push(e),e}}a(c,"items",[]);class n{static is(t){return this.objects.findIndex(e=>e===t)!==-1}static add(t){this.is(t)||(this.objects.push(t),this.make())}static remove(t){const e=this.objects.findIndex(s=>s===t);e!==-1&&(this.objects.splice(e,1),this.cache=[]),this.make()}static reset(){this.cache=[],this.start()}static make(){this.event&&this.objects.length<1?(this.event.stop(),this.event=void 0):this.objects.length>0&&(this.event=new A(window,["scroll-sync"],()=>this.start()).start(),this.start())}static getItemIdByVisible(){const t=[];return this.objectsAdaptive.forEach(e=>{e.isBeyond()&&t.push(e.getId())}),t}static start(){var t;if(this.isAdaptive()){this.makeAdaptive();const e=this.getItemIdByVisible();this.isCache(e)&&(this.cache=e,this.makeSize(),this.makePercent(),this.makeFactorMax(),this.makeCallback())}else(t=this.event)==null||t.stop()}static makeAdaptive(){this.objectsAdaptive=[],this.objects.forEach(t=>{t.make(),t.isBeyond()&&this.objectsAdaptive.push(t)})}static makeSize(){c.reset(),this.objectsAdaptive.forEach(t=>{const e=t.getElement();e&&t.isBeyond()&&c.get(t.getGroup()).makeWidth(t.getWidth()).makeHeight(t.getHeight()).makeOffsetWidth(e.offsetWidth).makeOffsetHeight(e.offsetHeight)})}static makePercent(){c.isSize()&&this.objectsAdaptive.forEach(t=>{const e=t.getElement(),s=c.get(t.getGroup());if(e){const h=s.getWidth(),o=s.getHeight();t.setPercent(t.getWidth()*(h?1/h:0)*(s.getOffsetWidth()/e.offsetWidth),t.getHeight()*(o?1/o:0)*(s.getOffsetHeight()/e.offsetHeight))}})}static makeFactorMax(){c.isSize()&&this.objectsAdaptive.forEach(t=>{t.isVisible()&&c.get(t.getGroup()).makeFactorMax(t.getFactor())})}static makeCallback(){this.objectsAdaptive.forEach(t=>t.makeCallback())}static isAdaptive(){return!!this.objects.find(t=>t.is())}static isCache(t){return this.cache.join("|")!==t.join("|")}}a(n,"objects",[]),a(n,"objectsAdaptive",[]),a(n,"cache",[]),a(n,"event"),a(n,"time");const D="main",y=512;class L{constructor(t,e,s,h){a(this,"percent",{width:0,height:0}),a(this,"beyond",!1),a(this,"visible",!1),this.props=t,this.data=e,this.element=s,this.callback=h,this.reset()}is(){var t;return!!((t=this.props)!=null&&t.adaptive)&&this.data.isImage()&&!!(this.element.value&&this.element.value.closest("body")&&(this.getWidth()||this.getHeight()))}isGroup(t){return this.getGroup()===t}isBeyond(){return this.beyond}isVisible(){return this.visible}getGroup(){var t;return((t=this.props)==null?void 0:t.adaptiveGroup)??D}getId(){return R(this.element.value)}getElement(){return this.element.value}getWidth(){var t;return f(((t=this.props)==null?void 0:t.objectWidth)??0)}getHeight(){var t;return f(((t=this.props)==null?void 0:t.objectHeight)??0)}getType(){if(this.getWidth()&&this.percent.width>0)return"x";if(this.getHeight()&&this.percent.height>0)return"y"}getSize(){if(this.element.value&&this.data.isImage()){const t=this.data.getImage();switch(this.getType()){case"x":return t.height*(this.element.value.offsetWidth*this.percent.width/t.width);case"y":return t.width*(this.element.value.offsetHeight*this.percent.height/t.height)}}return 0}getFactor(){const t=this.element.value,e=this.getSize(),s=this.getType();if(t){if(s==="x"&&e>t.offsetHeight)return t.offsetHeight/e;if(s==="y"&&e>t.offsetWidth)return t.offsetWidth/e}return 1}getBackgroundSize(){const t=c.get(this.getGroup()).getFactorMax();switch(this.getType()){case"x":return`${100*this.percent.width*t}% auto`;case"y":return`auto ${100*this.percent.height*t}%`}return null}setPercent(t,e){return this.percent.width=t,this.percent.height=e,this}update(){this.is()?n.add(this):n.remove(this)}reset(){this.is()&&(n.is(this)?n.reset():n.add(this))}remove(){this.is()&&n.remove(this)}make(){var t,e;if(this.beyond=!1,this.visible=!1,this.is())if((t=this.props)!=null&&t.adaptiveAlways)this.beyond=!0,this.visible=!0;else{const s=(e=this.element.value)==null?void 0:e.getBoundingClientRect();s&&(this.beyond=!(s.bottom<0-y||s.top>window.innerHeight+y),this.visible=!(s.bottom<0||s.top>window.innerHeight))}return this}makeCallback(){var t;return(t=this.callback)==null||t.call(this),this}}class U{constructor(t,e,s,h){this.props=t,this.data=e,this.coordinator=s,this.adaptive=h}get(){if(this.coordinator.is())return this.getSizeByCoordinator();if(this.adaptive.is()){const t=this.adaptive.getBackgroundSize();if(t)return t.toString()}return this.getSizeForItem()}getImage(){const t=this.data.getImage();switch(typeof t){case"string":return`url("${t}")`;case"object":return`url("${t.src}")`;default:return null}}getSize(t,e){const s=this.data.getImage();return typeof s=="object"?s.height<s.width?`auto ${e}`:`${t} auto`:null}getSizeByCoordinator(){const{width:t,height:e}=this.coordinator.getSize();return this.getSize(t,e)}getSizeForItem(){var t;const e=(t=this.props)==null?void 0:t.size;return e&&I(e)?e.toString().match(/%$/)?this.getSize(e,e):e.toString():null}}let X=class extends w{constructor(i,t,e){super(i,e),a(this,"type"),a(this,"data"),a(this,"coordinator"),a(this,"position"),a(this,"adaptiveItem"),a(this,"background"),this.props=i,this.callback=e,this.type=new G(i),this.data=new O(i,this.type,()=>{this.adaptiveItem.is()&&this.adaptiveItem.reset(),this.make(!0)}),this.coordinator=new V(i),this.position=new T(i,this.coordinator),this.adaptiveItem=new L(i,this.data,t,()=>this.make(!0)),this.background=new U(i,this.data,this.coordinator,this.adaptiveItem)}destructor(){this.adaptiveItem.remove()}getType(){return this.type.get()}getValue(){var i;return(i=this.props)==null?void 0:i.value}getData(){return this.data}getText(){const i=this.type.get();if(i===r.pdf){const e=this.data.getImage();if(u(e))return e}const t=this.getValue();if(i&&u(t)&&["filled","outlined","round","sharp","two-tone","material"].indexOf(i)!==-1)return t.replace(/^(filled|outlined|round|sharp|two-tone)-/,"")}getClasses(){const i=this.type.get(),t={[`??--type--${i}`]:i!==void 0,"??--background":!!this.background.getImage(),notranslate:!0};switch(i){case"filled":case"outlined":case"round":case"sharp":case"two-tone":case"material":t["material-icons"]=!0;break}return t}getStyles(){var i;return((i=this.event)==null?void 0:i.styles)||{}}updateAdaptive(){return this.adaptiveItem.update(),this.make(!0),this}async initEvent(){(!this.event.image||this.isChanged("image",["value","url"]))&&(this.event.image=this.getData().getImage()),this.event.styles=this.initStyles()}initStyles(){var i,t;const e=this.getValue();if(e)switch(this.type.get()){case r.file:case r.image:return{"background-image":this.background.getImage(),"background-size":this.background.get(),"background-position-x":(i=this.position)==null?void 0:i.getX(),"background-position-y":(t=this.position)==null?void 0:t.getY()};case r.icon:case r.flag:return{"background-image":this.background.getImage()};case r.public:return{"mask-image":this.background.getImage()};case r.color:if(u(e))return{"background-color":e}}return{}}};class Y{constructor(t,e){a(this,"item"),a(this,"type",m(()=>this.item.getType())),a(this,"data",d()),a(this,"text",m(()=>this.item.getText())),a(this,"classes",d()),a(this,"styles",d()),this.item=new X(t,e,s=>{this.data.value=s.image,this.classes.value=this.item.getClasses(),this.styles.value=s.styles}),this.classes.value=this.item.getClasses(),p(()=>this.item.data.make(!0)),p(()=>this.item.updateAdaptive())}destructor(){this.item.destructor()}}class rt extends j{constructor(t,e,s){super(t,e,s),a(this,"image"),this.image=new Y(this.props,this.element),this.init(),x(()=>this.image.destructor()),$(this.image.data,h=>{var o;return(o=this.emits)==null?void 0:o.call(this,"load",{type:this.image.type.value,image:h})})}makeOptions(){return this}initSetup(){return{type:this.image.type,data:this.image.data,text:this.image.text,renderValue:()=>this.renderValue()}}initExpose(){const t=this.setup();return{type:t.type,data:t.data}}initClasses(){return{main:{...this.toClassName(this.image.classes.value)}}}initStyles(){return{...this.image.styles.value}}initRender(){const t=this.setup();return g("span",{ref:this.element,class:t.classes.value.main,style:t.styles.value,translate:"no"},t.renderValue())}renderValue(){const t=this.setup();return t.type.value===r.pdf?[g("object",{data:t.data.value})]:t.text.value}}const Z={adaptiveGroup:"basic"},ht={value:[String,File],coordinator:Array,size:String,x:[String,Number],y:[String,Number],adaptiveGroup:{type:String,default:Z.adaptiveGroup},adaptiveAlways:Boolean,objectWidth:[String,Number],objectHeight:[String,Number],url:String,turn:Boolean,disabled:Boolean,hide:Boolean,adaptive:Boolean};export{R as f,ht as h,rt as n};
