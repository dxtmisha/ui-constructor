#!/usr/bin/env ts-node
"use strict";var f=Object.defineProperty;var j=(o,t,e)=>t in o?f(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var u=(o,t,e)=>(j(o,typeof t!="symbol"?t+"":t,e),e);const d=require("commander"),g=require("./transformation-CVs_QEUg.cjs"),m=require("./toArray-C_3YLL9r.cjs"),y=require("./toKebabCase-DL-Uz_om.cjs"),s={},h=class h{static is(t){return s.existsSync(this.joinPath(t))}static isDir(t){var e;return this.is(t)?((e=s.statSync(this.joinPath(t)))==null?void 0:e.isDirectory())??!1:!this.joinPath(t).match(/\.\w+$/)}static isModule(){return this.module}static joinPath(t){return s.join(...m.toArray(t))}static joinPathByName(t,e,i="json"){return this.joinPath([...m.toArray(t),this.getFileName(e,i)])}static getRoot(){return this.root}static getFileName(t,e="json"){return g.isFilled(e)?`${y.toKebabCase(t)}.${e}`:t}static getPathDir(t){return this.isDir(t)?this.joinPath(t):s.dirname(this.joinPath(t))}static getPathFile(t,e,i="json"){return[...m.toArray(t),this.getFileName(e,i)]}static splitForDir(t){var i;const e=this.isDir(t)?t:(i=this.parse(t))==null?void 0:i.dir;return this.joinPath(e||"").split(s.sep)}static parse(t){return s.parse(this.joinPath(t))}static sep(){return s.sep}static stat(t){if(this.is(t))return{...s.statSync(this.joinPath(t))}}static readDir(t){return this.is(t)?s.readdirSync(this.joinPath(t)):[]}static readDirRecursive(t,e=[]){const i=this.readDir(t),a=[];return i.forEach(n=>{const c=[...t,n];this.isDir(c)?a.push(...this.readDirRecursive(c,[...e,n])):a.push(this.joinPath([...e,n]))}),a}static readFile(t){if(this.is(t))return g.transformation(s.readFileSync(this.joinPath(t)).toString())}static readFileOnly(t){if(this.is(t))return s.readFileSync(this.joinPath(t)).toString()}static createDir(t){const e=[this.root];this.splitForDir(this.removeRootInPath(t)).forEach(i=>{e.push(i),this.is(e)||s.mkdirSync(this.joinPath(e))})}static write(t,e,i,a="json"){this.writeByPath(this.joinPathByName(t,e,a),i)}static writeByPath(t,e){this.createDir(t),s.writeFileSync(this.joinPath(t),typeof e=="object"?JSON.stringify(e):e)}static removeDir(t){this.isDir(t)&&s.rmSync(this.joinPath(t),{recursive:!0,force:!0})}static removeFile(t){this.is(t)&&s.unlinkSync(this.joinPath(t))}static rename(t,e){s.renameSync(this.joinPath(t),this.joinPath(e))}static removeRootInPath(t){return this.joinPath(t).replace(`${this.root}${s.sep}`,"").replace(`${this.root}`,"")}};u(h,"root"),u(h,"module"),h.module=!!__dirname.match("node_modules"),h.root=h.module?__dirname.replace(/node_modules.*?$/,""):h.joinPath([__dirname,"..","..",".."]);let r=h;const l={vue:"UI_CORE_VUE","vue-router":"UI_CORE_VUE_ROUTER",vuex:"UI_CORE_VUEX",ui:"UI_CORE_UI"};class D{constructor(t){this.dirs=t}make(){return r.readDirRecursive(this.dirs).forEach(e=>{const i=[...this.dirs,e],a=r.readFile(i);a&&a.match(this.getRegMatch())&&r.writeByPath(i,a.replace(this.getRegReplace(),(n,c,P)=>`const{${c.replace(/([^ ]+) as ([^, ]+)/ig,"$1: $2")}}=${this.getModule(P)}`))}),this}getModule(t){const e=t.trim();return e in l?`window.${l[e]}`:e}getRegList(){return Object.keys(l).join("|")}getRegMatch(){return new RegExp(`from ?"(${this.getRegList()})"`)}getRegReplace(){return new RegExp(`import ?{ ?([^}]+) ?} ?from ?"(${this.getRegList()})"`,"ig")}}const R=[__dirname,"..","packages"],_=[".."],v="temp";class p{constructor(t){u(this,"paths");this.template=t,this.paths=this.initTemplatePaths()}make(){console.log("__dirname",__dirname),this.paths.length>0&&(this.paths.forEach(t=>{const e=this.read(t);if(e){const i=this.getProjectPath(t);r.is(i)||r.writeByPath(i,e)}}),this.makeUpdateLink(),this.removeTempDir())}makeBuild(){if(this.getTemplateDir()==="vue"){const t=[".","production","dist"],e=[".",".."];new D(t).make(),this.copyBuild(t,e)}}getTemplateDir(){return this.template}getTemplatePath(){return[...R,`project-${this.getTemplateDir()}`]}getProjectPath(t){const e=[..._,...Array.isArray(t)?t:[t]],i=e.length-1;return e[i].match("gitignore.txt")&&(e[i]=e[i].replace("gitignore.txt",".gitignore")),e}getProjectName(){const t=r.splitForDir(__dirname),e=[];let i=!1;for(;t.length>0&&(i?e.unshift(t.pop()):r.is([r.sep(),...t,"index.php"])?(i=!0,e.unshift(t.pop())):t.pop(),!r.is([r.sep(),...t,"ui","index.html"])););return`/${e.join("/")}/`}read(t){return r.readFileOnly([...this.getTemplatePath(),...Array.isArray(t)?t:[t]])}copyBuild(t,e){r.readDir(t).forEach(a=>{const n=[...e,a],c=[...t,a];r.isDir(n)?r.removeDir(n):r.removeFile(n),r.rename(c,n)})}makeUpdateLink(){const t=this.getProjectName(),e=this.getProjectPath(["index.php"]),i=r.readFile(e);i&&r.writeByPath(e,i.replace(/componentName = '[^']+'/,`componentName = '${t}'`));const a=this.getProjectPath(["vue","vite.config.ts"]),n=r.readFile(a);n&&r.writeByPath(a,n.replace(/BASE_URL = '[^']+'/,`BASE_URL = '${t}'`))}initTemplatePaths(){return r.readDirRecursive(this.getTemplatePath())}removeTempDir(){const t=this.getProjectPath([v]);return r.is(t)&&r.removeDir(t),this}}d.program.command("project").argument("[template]").description(`Initializes the file for working with Vue\r
Инициализирует файл для работы с Vue`).action((o="vue")=>{new p(o).make()});d.program.command("build").argument("[template]").description(`Transfer the compiled files to another location\r
Перенести скомпилированные файлы в другое место`).action((o="vue")=>{new p(o).makeBuild()});d.program.parse(process.argv);
