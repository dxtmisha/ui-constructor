"use strict";var x=Object.defineProperty;var b=(n,t,s)=>t in n?x(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s;var i=(n,t,s)=>(b(n,typeof t!="symbol"?t+"":t,s),s);const l=require("vue"),S=require("./DesignConstructorAbstract-BUcyMiAM.cjs"),B=require("./getElementId-BZ9YgGAh.cjs"),y=require("./getElement-BELE3lVa.cjs"),C=require("./EventItem-BcAMj33T.cjs"),m=require("./getMouseClientY-BAQt6jOl.cjs");var u=(n=>(n.display="display",n.preparation="preparation",n.flash="flash",n.open="open",n.hide="hide",n.close="close",n))(u||{}),w=(n=>(n.block="block",n.close="close",n.static="static",n.controlStatic="controlStatic",n))(w||{}),f=(n=>(n.top="top",n.center="center",n.bottom="bottom",n))(f||{});class M{constructor(){i(this,"status",u.close)}isHide(){return this.status===u.hide}isOpen(){return this.status===u.open||this.status===u.flash}get(){return this.status}set(t){return this.status=t,this}toDisplay(){return this.set(u.display),this}toPreparation(){return this.set(u.preparation),this}toFlash(){return this.set(u.flash),this}toOpen(){return this.set(u.open),this}toHide(){return this.set(u.hide),this}toClose(){return this.set(u.close),this}}class k{constructor(){i(this,"x",0);i(this,"y",0)}is(){return this.x!==0||this.y!==0}getX(){return this.x}getY(){return this.y}getShiftX(t){return this.x-t}getShiftY(t){return this.y-t}set(t,s){return this.x=t,this.y=s,this}reset(){return this.x=0,this.y=0,this}}class O{constructor(t,s){i(this,"persistent",!1);this.props=t,this.callback=s}get(){return this.persistent}on(){return this.props.persistent?(this.persistent=!0,this.makeCallback(),!0):!1}disabled(){return this.persistent&&(this.persistent=!1,this.makeCallback()),this}makeCallback(){return this.callback&&this.callback(),this}}class E{constructor(t){this.props=t}async preparation(t){this.props.preparation&&await this.props.preparation(t)}async beforeOpening(t){return this.props.beforeOpening?await this.props.beforeOpening(!t):!0}async opening(t){return this.props.opening?await this.props.opening(t):!1}}class H{constructor(t,s="is-window",e="is-control",o="is-body",r="is-body-context"){i(this,"id",`window--${B.getElementId()}`);this.persistent=t,this.className=s,this.classControl=e,this.classBody=o,this.classBodyContext=r}isWindow(t){return!!(t&&t.classList.contains(this.getClassMain()))}getId(){return this.id}getClassMain(){return this.className}getClassControl(){return this.classControl}getClassControlAndId(){return`${this.classControl} ${this.getId()}`}getClassStatus(t){return`${this.className}[data-status="${t}"]`}getClasses(){return{[this.getId()]:!0,"??--persistent":this.persistent.get()}}getSelectorControl(){return`.${this.classControl}.${this.getId()}`}getSelectorStatusControl(t){return`.${this.getClassMain()}--${t}`}findMain(t){return(t==null?void 0:t.closest(`.${this.className}`))??void 0}findControl(){return document.querySelector(`.${this.classControl}.${this.id}`)||void 0}findControlByElement(t){var s;if(t)return document.querySelector(`.${this.getClassControl()}.${(s=t.dataset)==null?void 0:s.window}`)??void 0}findBody(){return document.querySelector(`.${this.className}.${this.id} .${this.classBody}`)||void 0}findBodyContext(){return document.querySelector(`.${this.className}.${this.id} .${this.classBodyContext}`)||void 0}}class ${constructor(t,s){this.classes=t,this.element=s}isMain(){return!!this.element.value}getMain(){return this.element.value}getControl(){return this.classes.findControl()}getControlRect(){var t;return((t=this.getControl())==null?void 0:t.getBoundingClientRect())||void 0}getBody(){return this.classes.findBody()}getBodyRect(){var t;return((t=this.getBody())==null?void 0:t.getBoundingClientRect())||void 0}getBodyContext(){return this.classes.findBodyContext()}}class T{constructor(t,s){i(this,"control",!1);this.props=t,this.classes=s}is(){return!!this.props.flash}isOpen(){return this.is()||this.control}isClose(){return this.is()||!!document.querySelector(`.${this.classes.getClassStatus(u.hide)}`)}setControl(t){var s;return this.control=((s=t==null?void 0:t.closest(`.${this.classes.getClassControl()}`))==null?void 0:s.dataset.window)===this.classes.getId(),this}}class A{constructor(t,s){i(this,"top",0);i(this,"right",0);i(this,"bottom",0);i(this,"left",0);i(this,"width",0);i(this,"height",0);i(this,"innerWidth",0);i(this,"innerHeight",0);i(this,"padding",0);i(this,"location",f.center);this.classes=t,this.element=s}getTop(){return this.top}getRight(){return this.right}getBottom(){return this.bottom}getLeft(){return this.left}getWidth(){return this.width}getHeight(){return this.height}getInnerWidth(){return this.innerWidth}getInnerHeight(){return this.innerHeight}getPadding(){return this.padding}getLocation(){return this.location}getMaxHeight(){const t=this.element.getBody();return t?parseInt(getComputedStyle(t).maxHeight.replace(/[^0-9]+/g,"")):0}update(){const t=this.element.getMain(),s=this.element.getControlRect();return t&&s&&(this.top!==s.top||this.right!==s.right||this.bottom!==s.bottom||this.left!==s.left||this.width!==t.offsetWidth||this.height!==t.offsetHeight||this.innerWidth!==window.innerWidth||this.innerHeight!==window.innerHeight)?(this.top=s.top,this.right=s.right,this.bottom=s.bottom,this.left=s.left,this.width=t.offsetWidth,this.height=t.offsetHeight,this.innerWidth=window.innerWidth,this.innerHeight=window.innerHeight,this.padding=(window.innerHeight-this.getMaxHeight())/2,this.location=this.initLocation(s.top+s.height/2),!0):!1}reset(){return this.top=0,this.right=0,this.bottom=0,this.left=0,this.width=0,this.height=0,this.innerWidth=0,this.innerWidth=0,this}initLocation(t){switch(Math.floor(t/(window.innerHeight/3))){case 0:return f.top;case 2:return f.bottom}return f.center}}class R{constructor(t,s,e,o){i(this,"x",0);i(this,"y",0);this.props=t,this.client=s,this.element=e,this.coordinates=o}isOver(){var t;return((t=this.props)==null?void 0:t.axis)==="on"}getX(){return this.x}getY(){return this.y}getStyleX(){return`${this.x}px`}getStyleY(){return`${this.y}px`}getStyles(){return{"--??-sys-inset-x":this.getStyleX(),"--??-sys-inset-y":this.getStyleY()}}update(){return this.coordinates.update()?(this.setX(),this.setY(),!0):!1}updateScroll(){var s,e,o;const t=this.element.getBodyContext();if(this.isOver()&&this.props.overElement&&t&&t.scrollHeight>t.offsetHeight){const r=(s=y.getElement(this.props.overElement))==null?void 0:s.getBoundingClientRect(),h=(e=this.element.getBody())==null?void 0:e.getBoundingClientRect(),a=t==null?void 0:t.getBoundingClientRect(),c=(o=this.element.getControl())==null?void 0:o.getBoundingClientRect();if(t&&r&&h&&a){const g=r.height/2,p=r.top-a.top;if(c&&this.coordinates.getMaxHeight()===h.height){if(c.top+g<h.top){t.scrollTop+=p;return}if(c.bottom-g>h.bottom){t.scrollTop+=p-a.height+r.height;return}t.scrollTop+=p-(c.top-a.top)-c.height/2+g;return}t.scrollTop+=p-a.height/2+g}}}getAxis(){var t;return this.isOver()?"y":((t=this.props)==null?void 0:t.axis)??"y"}getIndent(t){return this.getAxis()===t?this.props.indent??4:0}getOverHeight(t,s){var r,h;const e=(s-t)/2;if(this.props.overElement){const a=(r=y.getElement(this.props.overElement))==null?void 0:r.getBoundingClientRect(),c=(h=this.element.getBody())==null?void 0:h.getBoundingClientRect();if(a&&c){const g=a.top-c.top,p=a.height/2;return s-g-p-e}}const o=this.coordinates.getHeight()/2;return s-e-o}setX(){const t=this.element.getMain();if(t){const s=this.getIndent("x"),e=this.props.contextmenu?this.client.getX():this.coordinates.getRight()+s,o=this.props.contextmenu?this.client.getX():this.coordinates.getLeft()-s,r=[];this.getAxis()==="x"?r.push(e,o):r.push(o,e),this.x=this.calculationInner(r[0],r[1],t.offsetWidth,window.innerWidth,this.coordinates.getWidth())}return this}setY(){const t=this.element.getMain();if(t){const s=this.getIndent("y"),e=this.props.contextmenu?this.client.getY():this.coordinates.getTop()-s,o=this.props.contextmenu?this.client.getY():this.coordinates.getBottom()+s,r=[];if(this.isOver())return this.y=this.calculationOver(this.getOverHeight(e,o),e,o,t.offsetHeight,window.innerHeight),this;this.getAxis()!=="x"?r.push(o,e):r.push(e,o),this.y=this.calculationInner(r[0],r[1],t.offsetHeight,window.innerHeight,this.coordinates.getHeight())}return this}calculationInner(t,s,e,o,r){const h=this.coordinates.getPadding();return t+e<=o-h?t:s-e>h?s-e:o/2-r/2}calculationOver(t,s,e,o,r){const h=this.coordinates.getPadding();if(e<h)return e;if(s>r-h){const a=s-o-h;return a<h?h:a}return t<h?h:t+o<=r-h?t:r-o-h}}class W{constructor(t,s,e){i(this,"x",null);i(this,"y",null);this.client=t,this.element=s,this.position=e}getStyleX(){return this.x!==null?`${this.x}px`:null}getStyleY(){return this.y!==null?`${this.y}px`:null}getStyles(){return{"--??-origin-x":this.getStyleX(),"--??-origin-y":this.getStyleY()}}update(){const t=this.element.getMain();if(!this.client.is())this.x=0,this.y=0;else if(t&&getComputedStyle(t).content!=='"--MENU--"'){const s=this.element.getBodyRect();s&&(this.x=this.client.getShiftX(s.left),this.y=this.client.getShiftY(s.top))}else this.x=this.client.getShiftX(this.position.getX()),this.y=this.client.getShiftY(this.position.getY());return this}reset(){return this.x=null,this.y=null,this}}class I{constructor(t,s,e){i(this,"activity",!1);i(this,"event");this.props=t,this.element=s,this.callback=e}is(){return this.activity}isStaticMod(){return!!this.props.staticMode}update(){const t=this.isStatic();return t!==this.activity?(this.activity=t,!0):!1}make(){this.isStaticMod()?!this.event&&this.element.getMain()&&(this.event=new C.EventItem(window,["resize"],()=>this.listener()),this.listener(),this.event.start()):this.stop()}makeAdaptive(){this.props.adaptive&&this.props.staticMode&&this.element.getMain()&&requestAnimationFrame(()=>this.listener())}stop(){this.event&&(this.event.stop(),this.event=void 0)}isStatic(){const t=this.element.getMain();return!!(t&&getComputedStyle(t).content==='"--STATIC--"')}listener(){var t;this.update()&&((t=this.callback)==null||t.call(this))}}class q{constructor(t,s,e,o,r,h,a,c,g,p,v){i(this,"open",!1);i(this,"first",!1);this.props=t,this.status=s,this.client=e,this.hook=o,this.element=r,this.flash=h,this.coordinates=a,this.position=c,this.origin=g,this.callback=p,this.callbackEmit=v}inDom(){return this.open||this.props.staticMode||this.first&&!!this.props.inDom}get(){return this.open}async set(t=!0){return this.open!==t&&await this.toggle(),this}async toggle(){if(await this.hook.beforeOpening(this.open)){const t=!this.open;t?(this.reset(),this.status.toDisplay(),await this.setOpenAndEmit(t),requestAnimationFrame(async()=>{await this.hook.preparation(this.open),await this.watchPosition(),await this.callback(),requestAnimationFrame(async()=>{this.position.updateScroll(),this.status.toPreparation(),await this.callback(),requestAnimationFrame(async()=>{await this.hook.opening(this.open),this.flash.isClose()?this.status.toFlash():this.status.toOpen(),await this.callback()})})})):(this.client.reset(),this.flash.isOpen()?this.toClose():(this.status.toHide(),await this.callback()))}return this}close(){this.status.isHide()&&this.toClose()}reset(){return this.coordinates.reset(),this.origin.reset(),this}async watchPosition(){this.open&&this.element.isMain()?(this.position.update(),this.origin.update(),this.watchCoordinates()):this.reset()}async setOpenAndEmit(t){return this.open=t,t&&!this.first&&(this.first=!0),await this.callback(),this.callbackEmit(),this}watchCoordinates(){return m.frame(()=>{const t=this.element.getMain();t&&getComputedStyle(t).content==='"--MENU--"'&&this.position.update()&&this.callback().then()},()=>this.open&&!this.status.isHide()),this}toClose(){setTimeout(()=>this.setOpenAndEmit(!1).then(),48),this.status.toClose(),this.hook.opening(this.open).then()}}class D{constructor(t,s,e,o,r,h,a){i(this,"target");i(this,"focus");this.props=t,this.persistent=s,this.classes=e,this.element=o,this.staticMode=r,this.open=h,this.callback=a}async update(t){this.target=t,this.focus=this.getFocus(),!this.staticMode.is()&&(this.open.get()?this.isContextmenu()?(await this.open.reset().watchPosition(),await this.callback()):this.focus===null?await this.open.toggle():this.isFocus()?this.isTarget()?this.persistent.on()||await this.open.toggle():(this.isClose()||this.isAutoClose()||!this.isChildren())&&await this.open.toggle():this.isNotBlock()&&(this.isChildren()?requestAnimationFrame(async()=>{var s;["open","flash"].indexOf(((s=this.focus)==null?void 0:s.dataset.status)||"")===-1&&await this.open.toggle()}):await this.open.toggle()):this.isEnabled()&&await this.open.toggle())}getFocus(){return this.classes.findMain(this.getTarget())}getTarget(){return this.target??this.element.getMain()??document.body}isFocus(){return this.element.getMain()===this.focus}isTarget(){return this.element.getMain()===this.target}isChildren(t=this.getTarget()){const s=this.classes.findMain(t);return!!(s&&(s.dataset.window===this.classes.getId()||this.isChildren(this.classes.findControlByElement(s))))}isEnabled(){const t=this.classes.getSelectorStatusControl(w.controlStatic);return!this.props.disabled&&!this.getTarget().closest(t)}isAutoClose(){const t=this.classes.getSelectorStatusControl(w.static);return!!this.props.autoClose&&!this.getTarget().closest(`${t}, .${this.classes.getId()} .${this.classes.getClassControl()}`)}isNotBlock(){var s;const t=this.classes.getSelectorStatusControl(w.block);return!this.classes.isWindow(this.getTarget())&&!((s=this.classes.findControlByElement(this.focus))!=null&&s.closest(t))}isContextmenu(){return!!(this.props.contextmenu&&this.getTarget().closest(this.classes.getSelectorControl()))}isClose(){const t=this.classes.getSelectorStatusControl(w.close),s=this.classes.getSelectorStatusControl(w.static);return!!this.getTarget().closest(`${t}:not(${s})`)}}class F{constructor(t,s,e,o,r,h,a){i(this,"event");this.props=t,this.status=s,this.client=e,this.persistent=o,this.flash=r,this.open=h,this.verification=a,this.event=new C.EventItem("body",["click","contextmenu"],c=>this.onGlobal(c))}async onClick(t){this.props.contextmenu||await this.on(t)}async onContextmenu(t){this.props.contextmenu&&(t.preventDefault(),await this.on(t))}onTransition(){this.open.close()}onPersistent(){this.persistent.disabled()}start(){return this.event.start(),this}stop(){return this.event.stop(),this}toggle(){return this.open.get()&&this.status.isOpen()?this.start():this.stop(),this}async on(t){this.client.set(m.getMouseClientX(t),m.getMouseClientY(t)),await this.verification.update(t.target)}async onGlobal(t){this.open.get()?(this.flash.setControl(t==null?void 0:t.target),await this.verification.update(t==null?void 0:t.target)):this.event.stop()}}class P{constructor(t,s,e,o,r="is-window",h="is-control",a="is-body",c="is-body-context"){i(this,"status");i(this,"client");i(this,"persistent");i(this,"hook");i(this,"classes");i(this,"element");i(this,"flash");i(this,"coordinates");i(this,"position");i(this,"origin");i(this,"staticMode");i(this,"open");i(this,"verification");i(this,"event");this.status=new M,this.client=new k,this.persistent=new O(t,e),this.hook=new E(t),this.classes=new H(this.persistent,r,h,a,c),this.element=new $(this.classes,s),this.flash=new T(t,this.classes),this.coordinates=new A(this.classes,this.element),this.position=new R(t,this.client,this.element,this.coordinates),this.origin=new W(this.client,this.element,this.position),this.staticMode=new I(t,this.element,e),this.open=new q(t,this.status,this.client,this.hook,this.element,this.flash,this.coordinates,this.position,this.origin,async()=>{await e(),this.event.toggle()},()=>o(this.getEmitOptions())),this.verification=new D(t,this.persistent,this.classes,this.element,this.staticMode,this.open,e),this.event=new F(t,this.status,this.client,this.persistent,this.flash,this.open,this.verification),t.open&&requestAnimationFrame(()=>this.open.set(t.open).then())}getClasses(){return{...this.classes.getClasses(),"??--staticMode":this.staticMode.is(),[`??--location--${this.coordinates.getLocation()}`]:!0}}getStyles(){return{...this.origin.getStyles(),...this.position.getStyles()}}getEmitOptions(){return{id:this.classes.getId(),element:this.element.getMain(),control:this.element.getControl(),open:this.open.get()}}update(){return this.staticMode.make(),this.staticMode.makeAdaptive(),this}stop(){return this.event.stop(),this.staticMode.stop(),this}}class Y{constructor(t,s,e,o="is-window",r="is-control",h="is-body",a="is-body-context"){i(this,"window");i(this,"status",l.shallowRef());i(this,"staticMode",l.shallowRef(!1));i(this,"inDom",l.shallowRef(!1));i(this,"open",l.shallowRef(!1));i(this,"classes",l.shallowRef({}));i(this,"styles",l.shallowRef({}));this.window=new P(t,s,async()=>this.update(),e,o,r,h,a),l.watchEffect(async()=>await this.window.open.set(t.open)),l.watchEffect(async()=>{this.window.update(),await this.update()}),l.onUnmounted(()=>this.window.stop())}getId(){return this.window.classes.getId()}getClassControl(){return this.window.classes.getClassControlAndId()}async setOpen(t=!0){await this.window.open.set(t)}async toggle(){await this.window.open.toggle()}async onClick(t){return this.window.event.onClick(t)}async onContextmenu(t){return this.window.event.onContextmenu(t)}onTransition(){return this.window.event.onTransition()}onPersistent(){return this.window.event.onPersistent()}async update(){this.status.value=this.window.status.get(),this.staticMode.value=this.window.staticMode.is(),this.inDom.value=this.window.open.inDom(),this.open.value=this.window.open.get(),this.updateClasses(),await l.nextTick()}updateClasses(){return this.classes.value=this.window.getClasses(),this.styles.value=this.window.getStyles(),this}}class X extends S.DesignConstructorAbstract{constructor(s,e,o){super(s,e,o);i(this,"window");this.window=new Y(this.props,this.element,r=>{var h;return(h=this.emits)==null?void 0:h.call(this,"window",r)},this.getName(),this.getSubClass("control"),this.getSubClass("body"),this.getSubClass(["body","context"])),this.init()}makeOptions(){return this}initSetup(){return{id:this.window.getId(),status:this.window.status,open:this.window.open,inDom:this.window.inDom,staticMode:this.window.staticMode,slotControl:{class:this.window.getClassControl(),onclick:async s=>await this.window.onClick(s),oncontextmenu:async s=>this.window.onContextmenu(s)},setOpen:s=>this.window.setOpen(s),toggle:()=>this.window.toggle(),onTransition:()=>this.window.onTransition(),onPersistent:()=>this.window.onPersistent(),renderBodyContext:()=>this.renderBodyContext()}}initExpose(){const s=this.setup();return{id:s.id,open:s.open,setOpen:s.setOpen,toggle:s.toggle}}initClasses(){return{main:{...this.toClassName(this.window.classes.value)},body:this.getSubClass("body"),bodyContext:this.getSubClass("body__context"),control:this.getSubClass("control")}}initStyles(){return{...this.toClassName(this.window.styles.value)}}initRender(){const s=this.setup(),e=[];if(this.initSlot("control",e,s.slotControl),s.inDom.value){const o=[this.renderBody()];e.push(l.h(l.Teleport,{key:"teleport",disabled:s.staticMode.value,to:"body"},[l.h("div",{...this.getAttrs(),key:"main",ref:this.element,class:s.classes.value.main,style:s.styles.value,"data-window":s.id,"data-status":s.status.value,onTransitionend:s.onTransition,onAnimationend:s.onPersistent},o)]))}return e}renderBody(){const s=this.setup(),e=[this.initSlot("title"),this.renderBodyContext(),this.initSlot("footer")];return l.h("div",{key:"body",class:s.classes.value.body},e)}renderBodyContext(){const s=this.setup(),e=()=>this.initSlot("default"),o={key:"bodyContext",class:s.classes.value.bodyContext};return this.components.renderOne("scrollbar",o,e)??l.h("div",o,e)}}const d={axis:"y",indent:4,overscroll:!0},N={open:Boolean,disabled:Boolean,preparation:Function,beforeOpening:Function,opening:Function,contextmenu:Boolean,staticMode:Boolean,axis:{type:String,default:d==null?void 0:d.axis},indent:{type:Number,default:d==null?void 0:d.indent},persistent:Boolean,overElement:[String,Object],autoClose:Boolean,flash:Boolean,inDom:Boolean,width:String,height:String,adaptive:String,overscroll:{type:Boolean,default:d==null?void 0:d.overscroll},dense:Boolean,fullscreen:Boolean,alignment:String,origin:String};exports.WindowDesign=X;exports.defaultsWindow=d;exports.propsWindow=N;
